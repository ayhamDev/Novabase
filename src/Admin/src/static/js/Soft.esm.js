const router={params:{},quary:{},title:"",page:""},store={};let navigate=()=>{setTimeout((()=>{navigate()}))};function isInDocument(e){for(var t=e;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof DocumentFragment?t.parentNode.host:t.parentNode}return!1}function Component(e=String(),t={Render({self:e=document.querySelector("*"),props:t={},root:o=document.querySelector("*")}){},Script({self:e=document.querySelector("*"),props:t={},root:o=document.querySelector("*")}){},Style({self:e=document.querySelector("*"),props:t={},root:o=document.querySelector("*")}){},useOnce({self:e=document.querySelector("*"),props:t={},root:o=document.querySelector("*")}){},shadowRoot:Boolean(!0),useStore:Boolean(!1)}){const{Render:o,Script:r,Style:n,useOnce:s,props:a}=t;return window.customElements.define(e.includes("-")?e:`${PREFIX}-${e}`,class extends HTMLElement{constructor(){super();let{shadowRoot:e}=t;null!=e&&null!=e||(e=!0),this.shadowRootMode=e,1==this.shadowRootMode&&this.attachShadow({mode:"open"}),t.useStore&&("object"==typeof t.useStore?t.useStore.forEach((e=>{store[`${e}.__Store_dep__`].push(this)})):store[`${t.useStore}.__Store_dep__`].push(this))}connectedCallback(){for(const e in a)Object.hasOwnProperty.call(data,e)&&this.setAttribute(e,data[e]);this.obs=new MutationObserver((function(e){e.forEach((function(e){"attributes"===e.type&&(1==e.target.shadowRootMode&&RenderComponent(e.target.shadowRoot,o,r,n,s,!1),0==e.target.shadowRootMode&&RenderComponent(e.target,o,r,n,s,!1))}))})),this.obs.observe(this,{attributes:!0}),1==this.shadowRootMode&&RenderComponent(this.shadowRoot,o,r,n,s,!0),0==this.shadowRootMode&&RenderComponent(this,o,r,n,s,!0),this.__update__=()=>{console.log("__update__"),1==this.shadowRootMode&&RenderComponent(this.shadowRoot,o,r,n,s,!1),0==this.shadowRootMode&&RenderComponent(this,o,r,n,s,!1)}}}),t=>{const o=document.createElement(e.includes("-")?e:`${PREFIX}-${e}`);if("object"==typeof t)for(const e in t)Object.hasOwnProperty.call(t,e)&&o.setAttribute(e,t[e]);return o}}function DomParser(e=String()){return(new DOMParser).parseFromString(e,"text/html")}function RenderComponent(e,t,o,r,n,s){const a=Object.assign({},...Array.from(e?.host?e.host.attributes:e.attributes,(({name:e,value:t})=>({[e]:t}))));if(e.innerHTML="",!t({root:e?.host?e.host:e,self:e.firstChild,props:a}))return null;const u=DomParser(t({root:e?.host?e.host:e,self:e.firstChild,props:a})).body.firstChild;e.append(u),u&&isInDocument(document.querySelector("slot[name=router]"))&&RouterLink(u),t({root:e?.host?e.host:e,self:e.firstChild,props:a})&&"function"==typeof r&&e.append(DomParser(`<style>\n        ${r({root:e?.host?e.host:e,self:e.firstChild,props:a})}</style>\n      `).head.querySelector("style")),t({root:e?.host?e.host:e,self:e.firstChild,props:e?.host?e.host.dataset:e.dataset})&&"function"==typeof o&&o({root:e?.host?e.host:e,self:e.firstChild,props:a}),t({root:e?.host?e.host:e,self:e.firstChild,props:a})&&"function"==typeof n&&1==s&&n({root:e?.host?e.host:e,self:e.firstChild,props:a})}function CreateStore(e="app",t={}){return store[e]=new Proxy(t,{set:(t,o,r)=>(t[o]=r,store[`${e}.__Store_dep__`].forEach((e=>{isInDocument(e)&&e.__update__()})),!0)}),store[`${e}.__Store_dep__`]=[],store[e]}function useStore(e="app"){return store[e]}function CreateBrowserRouter({exact:e="/",_404:t,layout:o,Routes:r=[]}){return window.onpopstate=()=>handleLocation({exact:e,_404:t,layout:o,Routes:r}),handleLocation({exact:e,_404:t,layout:o,Routes:r}),navigate=(n="/")=>{history.pushState(null,null,n),handleLocation({exact:e,_404:t,layout:o,Routes:r})},(n="/")=>{history.pushState(null,null,n),handleLocation({exact:e,_404:t,layout:o,Routes:r})}}function useRouter(){return{params:router.params,quary:router.quary,page:router.page,title:router.title}}function handleLocation({exact:e,_404:t,layout:o,Routes:r}){location.pathname!=e&&"/"==location.pathname&&(history.pushState(null,null,e),handleLocation({exact:e,_404:t,layout:o,Routes:r}));const n=r.find((e=>{const t=ConvertURLToArray(e.path),o=ConvertURLToArray(location.pathname);return o.length==t.length&&!e.path.includes(":")&&o.join("")==t.join("")}));if(n)return RouterRender(n,o,{});let s=!1;if(r.filter((e=>e.path.includes(":"))).forEach((n=>{const a=ConvertURLToArray(n.path),u=(a.filter((e=>e.includes(":"))),ConvertURLToArray(location.pathname));if(a.length==u.length){let l=!1;a.forEach(((i,c)=>{if(!l&&c+1==a.length)return l=!0,s=!0,RouterDynamicRender(n,ConvertURLToArray(n.path),ConvertURLToArray(location.pathname),o,(()=>{history.replaceState(null,null,t),handleLocation({exact:e,_404:t,layout:o,Routes:r})}));if(!i.includes(":")){if(!l&&i==u[c])return!0;l=!0}}))}})),!s&&"function"==typeof t)return t();s||"string"!=typeof t||(history.replaceState(null,null,t),handleLocation({exact:e,_404:t,layout:o,Routes:r}))}function RouterRender(e,t,o){e.page&&setPage(e.page),e.title&&setTitle(e.title),setParams(o),setQuary();const r=document.querySelector("slot[name=router]");if(r.innerHTML="",e.layout){const t=e.layout.cloneNode(!0);r.append(t),t.shadowRootMode?t.shadowRoot.querySelector("slot").replaceWith(e.render):t.querySelector("slot").replaceWith(e.render)}if(!e.layout&&t){const o=t.cloneNode(!0);r.append(o),o.shadowRootMode?o.shadowRoot.querySelector("slot").replaceWith(e.render):o.querySelector("slot").replaceWith(e.render)}e.layout||t||r.append(e.render)}function RouterLink(e=document.querySelector("")){e.querySelectorAll("a[link]").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),navigate(e.href)}))}))}function RouterDynamicRender(e,t,o,r,n){let s={};if(CheckForEqBetweenTwoURLs(t,o)){t.forEach(((e,r)=>{e.includes(":")&&(t[r]=o[r],s[`${e.replace(":","")}`]=o[r])})),e&&RouterRender(e,r,s)}else n()}function CheckForEqBetweenTwoURLs(e,t){let o=!0;return e.forEach(((e,r)=>{o&&(e.includes(":")||(o=e==t[r]))})),o}function ConvertURLToArray(e){let t=e.split("/");return""==t[t.length-1]&&t.pop(),t.shift(),t}function setParams(e){router.params=e}function setQuary(e){if(e){const t=new URLSearchParams(e),o=Object.fromEntries(t.entries());router.quary=o}else{const e=new URLSearchParams(window.location.search),t=Object.fromEntries(e.entries());router.quary=t}}function setTitle(e=""){router.title=e,document.title=e}function setPage(e=""){router.page=e} 
 export {CreateBrowserRouter, useRouter , CreateStore ,useStore, Component, navigate, setQuary, setTitle}